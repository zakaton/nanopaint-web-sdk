<html>
  <head>
    <title>Nanopaint Web SDK</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="https://cdn.glitch.global/1f41f414-1365-4acf-9f8c-bff8c305c06b/nanopaint-icon.png?v=1692827697875"
    />
    <script src="src/NanoPaint.js"></script>
  </head>
  <body>
    <h1>Nanopaint Web SDK</h1>

    <button id="connectButton">connect</button>

    <div id="connected">
      <label
        >sample rate (ms)
        <input
          id="sampleRate"
          value="0"
          type="number"
          min="0"
          step="10"
          max="1000"
      /></label>

      <ol id="sensors"></ol>

      <template id="sensorTemplate">
        <li class="sensor">
          <progress min="0" max="1" value="0"></progress>
        </li>
      </template>
    </div>
  </body>

  <script>
    const nanopaint = new Nanopaint();

    const connectedContainer = document.getElementById("connected");
    const sensorsContainer = document.getElementById("sensors");
    const sensorProgresses = [];
    const sensorTemplate = document.getElementById("sensorTemplate");
    for (let index = 0; index < nanopaint.numberOfPressureSensors; index++) {
      const sensorContainer = sensorTemplate.content
        .cloneNode(true)
        .querySelector(".sensor");
      sensorsContainer.appendChild(sensorContainer);
      sensorProgresses[index] = sensorContainer.querySelector("progress");
    }

    const sampleRateInput = document.getElementById("sampleRate");
    sampleRateInput.addEventListener("input", async (event) => {
      const sampleRate = Number(event.target.value);
      await nanopaint.setSampleRate(sampleRate);
    });

    const connectButton = document.getElementById("connectButton");
    connectButton.addEventListener("click", () => nanopaint.connect());
    nanopaint.addEventListener("connected", () => {
      connectButton.setAttribute("hidden", "");
      connectedContainer.removeAttribute("hidden");
    });
    nanopaint.addEventListener("disconnected", () => {
      connectButton.removeAttribute("hidden");
      connectedContainer.setAttribute("hidden", "");
    });
    nanopaint.addEventListener("normalizedValues", (event) => {
      const { values } = event.message;
      values.forEach((value, index) => {
        const progress = sensorProgresses[index];
        progress.value = value;
      });
    });
  </script>
</html>
